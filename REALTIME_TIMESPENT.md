# 实时 timeSpent 功能说明

## ✨ 新功能概述

现在 `timeSpent` 字段会**实时更新**，准确反映任务的实际花费时间！

## 🔄 更新机制

### **分钟级别实时更新**
- ⏱️ **每60秒更新一次**: `timeSpent` 每分钟增加1分钟
- 🎯 **精确记录**: 任务运行多长时间，就记录多长时间
- 💾 **性能优化**: 避免每秒更新，减少不必要的重渲染

### **更新时机**:
1. **运行中**: 每60秒 `timeSpent += 1分钟`
2. **任务完成**: 包含剩余不足60秒的时间
3. **手动停止**: 保留已运行的时间

## 🧪 测试场景 (当前番茄钟=1分钟)

### **场景1: 完整运行**
```
启动任务 → 运行1分钟 → 自动完成
timeSpent: 0 → 1.0分钟
显示: 🍅 x 1.0
```

### **场景2: 手动完成** ⭐ 新功能
```
启动任务 → 运行30秒 → 手动标记完成
timeSpent: 0 → 0.5分钟 (30秒)
显示: 🍅 x 0.5
```

### **场景3: 超时完成**
```
启动任务 → 运行1.5分钟 → 手动标记完成  
timeSpent: 0 → 1分钟 → 1.5分钟
显示: 🍅 x 1.5
```

### **场景4: 暂停恢复**
```
启动任务 → 运行45秒 → 暂停 → 恢复 → 运行30秒 → 完成
timeSpent: 0 → 保持 → 继续 → 1.3分钟
显示: 🍅 x 1.3
```

## 🛠️ 技术实现

### **数据结构变化**:
```javascript
// 任务计时器状态
{
  timeLeft: 60,           // 剩余时间（秒）
  isRunning: true,        // 是否运行中
  isPaused: false,        // 是否暂停
  runningSeconds: 45      // 🆕 当前运行的秒数
}

// 任务对象
{
  timeSpent: 1.5,         // 🆕 实时更新的花费时间（分钟）
  pomodoroCount: 1,       // 完整番茄钟数量
  // ... 其他字段
}
```

### **更新算法**:
```javascript
// 每秒执行
runningSeconds += 1;

// 每60秒执行
if (runningSeconds % 60 === 0) {
  timeSpent += 1;           // 增加1分钟
  runningSeconds = 0;       // 重置计数器
}

// 任务完成时
finalMinutes = Math.round((runningSeconds + 1) / 60 * 10) / 10;
timeSpent += finalMinutes;  // 加上剩余时间
```

## 📊 显示逻辑

### **任务完成时**:
```javascript
// 显示实际花费时间的番茄钟比例
const ratio = task.timeSpent / POMODORO_DURATION_MINUTES;
return `🍅 x ${ratio}`;  // 可能是小数，如 0.5, 1.3, 2.7
```

### **任务进行中**:
```javascript
// 显示完整番茄钟数量
return `🍅 x ${task.pomodoroCount}`;  // 整数，如 0, 1, 2
```

## 🚀 性能优化

- ✅ **分钟级更新**: 避免每秒更新状态
- ✅ **批量处理**: 多个任务同时更新
- ✅ **精确计算**: 最后一秒的时间也会计算在内
- ✅ **内存效率**: 只添加一个 `runningSeconds` 字段

## 🎯 用户体验提升

### **之前的问题**:
- ❌ 手动完成任务时间丢失
- ❌ 部分运行时间不被记录
- ❌ 番茄钟显示不准确

### **现在的解决**:
- ✅ 准确记录所有运行时间
- ✅ 手动完成显示正确比例
- ✅ 真实反映工作效率

**现在可以放心手动完成任务，时间记录将完全准确！** 🎉 