# 任务分类功能说明

## ✨ 功能概述

新增了任务分类功能，支持创建、管理和删除任务分类，任务列表按分类分组显示。

## 🎯 主要功能

### **1. 复合添加任务按钮**
- 📝 **任务输入框**: 输入任务名称
- 🏷️ **分类选择器**: 选择任务分类
- ➕ **添加按钮**: 创建带分类的任务

### **2. 分类管理**
- 📂 **默认分类**: 生活、工作
- ➕ **添加分类**: 在下拉框底部输入新分类名称
- ❌ **删除分类**: 点击分类旁的删除按钮
- 🛡️ **保护机制**: 至少保留一个分类

### **3. 分组显示**
- 📁 **按分类分组**: 任务按分类整齐分组显示
- 📊 **任务计数**: 显示每个分类下的任务数量
- 🎨 **美观设计**: 分类标题带背景色和图标

## 🖥️ 界面设计

### **复合按钮布局**：
```
[任务输入框] [分类选择▼] [添加任务]
```

### **分类下拉框**：
```
┌─────────────────┐
│ ✓ 生活      ❌  │  ← 选中状态
│   工作      ❌  │
│   学习      ❌  │
├─────────────────┤
│ [新分类输入] ➕  │  ← 添加新分类
└─────────────────┘
```

### **分组任务显示**：
```
📁 生活 (3)
┌─────────────────┐
│ 任务1           │
│ 任务2           │
│ 任务3           │
└─────────────────┘

📁 工作 (2)  
┌─────────────────┐
│ 任务4           │
│ 任务5           │
└─────────────────┘
```

## 🔧 技术实现

### **数据结构变化**：

#### **App.js 新增状态**：
```javascript
// 分类管理
const [taskCategories, setTaskCategories] = useLocalStorage('pomodoro-categories', ['生活', '工作']);

// 分类管理函数
const addCategory = useCallback((categoryName) => { ... });
const deleteCategory = useCallback((categoryName) => { ... });

// 修改addTask函数
const addTask = useCallback((taskName, category = '生活') => { ... });
```

#### **任务对象新增字段**：
```javascript
const newTask = {
  id: Date.now(),
  name: taskName,
  category: category,     // 🆕 任务分类
  completed: false,
  // ... 其他字段
};
```

#### **兼容性处理**：
```javascript
// 为旧任务添加默认分类
timeSpent: task.timeSpent || (task.pomodoroCount * POMODORO_DURATION_MINUTES),
category: task.category || '生活'  // 🆕 兼容旧数据
```

### **TaskManager.js 重构**：

#### **新增状态**：
```javascript
const [selectedCategory, setSelectedCategory] = useState(taskCategories[0] || '生活');
const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);
const [newCategoryInput, setNewCategoryInput] = useState('');
```

#### **分组逻辑**：
```javascript
// 按分类分组任务
const groupedTasks = taskCategories.reduce((groups, category) => {
  groups[category] = tasks.filter(task => task.category === category);
  return groups;
}, {});
```

#### **交互处理**：
```javascript
// 点击外部关闭下拉框
useEffect(() => {
  const handleClickOutside = (event) => { ... };
  document.addEventListener('mousedown', handleClickOutside);
}, []);
```

## 🎨 样式设计

### **复合按钮样式**：
- ✅ **统一高度**: 所有元素高度一致
- ✅ **合理间距**: 10px 间距保持整洁
- ✅ **响应式**: 移动端自动垂直排列

### **分类下拉框样式**：
- ✅ **悬浮效果**: 阴影和圆角设计
- ✅ **选中状态**: 蓝色背景突出显示
- ✅ **删除按钮**: 红色图标，悬停高亮
- ✅ **添加区域**: 分隔线区分操作区域

### **分组显示样式**：
- ✅ **分类标题**: 蓝色背景，白色文字，文件夹图标
- ✅ **任务计数**: 半透明背景，显示数量
- ✅ **卡片设计**: 圆角边框，阴影效果

## 🧪 测试场景

### **基础功能测试**：
1. **创建分类任务**:
   ```
   1. 输入任务名称 "买菜"
   2. 选择分类 "生活"
   3. 点击添加任务
   4. ✅ 任务出现在"生活"分组下
   ```

2. **添加新分类**:
   ```
   1. 点击分类下拉框
   2. 在底部输入 "学习"
   3. 点击添加分类
   4. ✅ 新分类出现在下拉选项中
   ```

3. **删除分类**:
   ```
   1. 点击分类旁的删除按钮
   2. ✅ 分类被删除
   3. ✅ 该分类下的任务移动到默认分类
   ```

### **边界情况测试**：
- ✅ **最后一个分类**: 无法删除，保证至少有一个分类
- ✅ **重复分类名**: 不允许添加相同名称的分类
- ✅ **空分类名**: 不允许添加空白分类
- ✅ **旧数据兼容**: 旧任务自动分配默认分类

## 📱 响应式适配

### **桌面端 (≥768px)**：
- 复合按钮水平排列
- 分类下拉框固定宽度 120px
- 分组标题字体 18px

### **移动端 (<768px)**：
- 复合按钮垂直排列
- 分类下拉框自适应宽度
- 分组标题字体 16px，内边距缩小

## 🎯 用户体验优化

### **交互体验**：
- ✅ **智能关闭**: 点击外部自动关闭下拉框
- ✅ **键盘支持**: Enter键快速添加分类
- ✅ **视觉反馈**: 悬停效果和过渡动画
- ✅ **防误删**: 最后一个分类不可删除

### **数据一致性**：
- ✅ **自动迁移**: 删除分类时任务自动迁移
- ✅ **状态同步**: 选中分类与下拉框状态一致
- ✅ **本地存储**: 分类和任务数据持久化保存

**现在可以高效地管理不同类型的任务，生活工作井然有序！** 📋✨ 